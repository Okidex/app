(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31278,e=>{"use strict";let s=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>s],31278)},80408,e=>{"use strict";var s=e.i(43476),a=e.i(932),t=e.i(71645),l=e.i(95187);let r=(0,l.createServerReference)("601396b450b9baa1be53916f7a359e4dc2a35deaf8",l.callServer,void 0,l.findSourceMapURL,"sendMessage");var n=e.i(93479),i=e.i(19455),c=e.i(31278);let d=(0,e.i(75254).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var o=e.i(49001),m=e.i(22016),f=e.i(75157);e.i(36180);var u=e.i(17875);e.i(11981);var x=e.i(61480),h=e.i(2747),p=e.i(8406);function j(){let e,l,j,S,N,w,_,k,I=(0,a.c)(47),{user:U,isUserLoading:M}=(0,x.useUser)();I[0]===Symbol.for("react.memo_cache_sentinel")?(e=[],I[0]=e):e=I[0];let[T,D]=(0,t.useState)(e),[C,L]=(0,t.useState)(null),[B,R]=(0,t.useState)(!0),[E,O]=(0,t.useState)(""),[P,q]=(0,t.useState)(!1),{toast:z}=(0,p.useToast)(),A=(0,x.useFirestore)();I[1]!==U||I[2]!==A?(l=()=>U?.id&&A?(0,u.query)((0,u.collection)(A,"conversations"),(0,u.where)("participantIds","array-contains",U.id)):null,j=[U,A],I[1]=U,I[2]=A,I[3]=l,I[4]=j):(l=I[3],j=I[4]);let F=(0,x.useMemoFirebase)(l,j);I[5]!==C||I[6]!==M||I[7]!==F||I[8]!==U||I[9]!==A?(S=()=>{if(!F){M||R(!1);return}R(!0);let e=(0,u.onSnapshot)(F,async e=>{let s=e.docs.map(y),a=[...new Set(s.flatMap(g).filter(e=>e!==U?.id))];if(a.length>0){let e=(0,u.query)((0,u.collection)(A,"users"),(0,u.where)("id","in",a)),t=(await (0,u.getDocs)(e)).docs.map(v),l=s.map(e=>{let s=t.find(s=>e.participantIds.includes(s.id)&&s.id!==U?.id),a=[U,s].filter(Boolean);return{...e,participants:a,messages:e.messages.sort(b)}});D(l),l.length>0&&!C&&L(l[0].id)}else D([]);R(!1)},e=>{console.error("Error fetching conversations:",e),R(!1)});return()=>e()},N=[F,U,C,A,M],I[5]=C,I[6]=M,I[7]=F,I[8]=U,I[9]=A,I[10]=S,I[11]=N):(S=I[10],N=I[11]),(0,t.useEffect)(S,N),I[12]!==C||I[13]!==T||I[14]!==U||I[15]!==E||I[16]!==z?(w=async e=>{if(e.preventDefault(),!E.trim()||!C||!U)return;q(!0);let s={id:`temp-${Date.now()}`,senderId:U.id,text:E,timestamp:new Date().toISOString()};D(T.map(e=>e.id===C?{...e,messages:[...e.messages,s]}:e)),O("");let a=await r(C,{senderId:U.id,text:E});a.success||(z({title:"Error Sending Message",description:a.error,variant:"destructive"}),D(T)),q(!1)},I[12]=C,I[13]=T,I[14]=U,I[15]=E,I[16]=z,I[17]=w):w=I[17];let K=w;if(M||B){let e,a,t,l;return I[18]===Symbol.for("react.memo_cache_sentinel")?(e=(0,s.jsxs)("div",{className:"w-1/3 border-r pr-4 flex flex-col",children:[(0,s.jsx)(h.Skeleton,{className:"h-8 w-40 mb-4"}),(0,s.jsx)(h.Skeleton,{className:"h-16 w-full mb-2"}),(0,s.jsx)(h.Skeleton,{className:"h-16 w-full mb-2"}),(0,s.jsx)(h.Skeleton,{className:"h-16 w-full"})]}),I[18]=e):e=I[18],I[19]===Symbol.for("react.memo_cache_sentinel")?(a=(0,s.jsx)(h.Skeleton,{className:"h-6 w-48 mb-4 border-b pb-2"}),I[19]=a):a=I[19],I[20]===Symbol.for("react.memo_cache_sentinel")?(t=(0,s.jsxs)("div",{className:"flex-1 space-y-4 p-4",children:[(0,s.jsx)(h.Skeleton,{className:"h-12 w-3/4"}),(0,s.jsx)(h.Skeleton,{className:"h-12 w-3/4 ml-auto"}),(0,s.jsx)(h.Skeleton,{className:"h-12 w-3/4"})]}),I[20]=t):t=I[20],I[21]===Symbol.for("react.memo_cache_sentinel")?(l=(0,s.jsxs)("div",{className:"h-[calc(100vh-10rem)] flex",children:[e,(0,s.jsxs)("div",{className:"w-2/3 pl-4 flex flex-col",children:[a,t,(0,s.jsxs)("form",{className:"mt-4 flex gap-2",children:[(0,s.jsx)(h.Skeleton,{className:"h-10 flex-1"}),(0,s.jsx)(h.Skeleton,{className:"h-10 w-10"})]})]})]}),I[21]=l):l=I[21],l}if(!U){let e;return I[22]===Symbol.for("react.memo_cache_sentinel")?(e=(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:"Please log in to view your messages."}),I[22]=e):e=I[22],e}if(I[23]!==C||I[24]!==T||I[25]!==U||I[26]!==K||I[27]!==P||I[28]!==E){k=Symbol.for("react.early_return_sentinel");e:{let e,a,t,l,r;I[31]!==C?(e=e=>e.id===C,I[31]=C,I[32]=e):e=I[32];let u=T.find(e);if(0===T.length){let e;I[33]===Symbol.for("react.memo_cache_sentinel")?(e=(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:"No conversations yet. Start a new one!"}),I[33]=e):e=I[33],k=e;break e}if(T.length>0&&!u){let e;I[34]===Symbol.for("react.memo_cache_sentinel")?(e=(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:"Select a conversation to start chatting."}),I[34]=e):e=I[34],k=e;break e}I[35]!==U?(a=e=>e.id!==U.id,I[35]=U,I[36]=a):a=I[36];let x=u.participants.find(a);if(I[37]===Symbol.for("react.memo_cache_sentinel")?(t=(0,s.jsx)("h1",{className:"text-2xl font-bold font-headline mb-4",children:"Messages"}),I[37]=t):t=I[37],I[38]!==C||I[39]!==T||I[40]!==U){let e;I[42]!==C||I[43]!==U?(e=e=>{let a=e.participants.find(e=>e.id!==U.id);if(!a)return null;let t=e.messages[e.messages.length-1];return(0,s.jsx)(m.default,{href:"#",onClick:()=>L(e.id),children:(0,s.jsxs)("div",{className:(0,f.cn)("p-3 rounded-lg flex gap-3 items-start",e.id===C?"bg-accent":"hover:bg-accent/50"),children:[(0,s.jsx)(o.default,{name:a.name,avatarUrl:a.avatarUrl}),(0,s.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,s.jsx)("p",{className:"font-semibold truncate",children:a.name}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:t?.text})]})]})},e.id)},I[42]=C,I[43]=U,I[44]=e):e=I[44],l=T.map(e),I[38]=C,I[39]=T,I[40]=U,I[41]=l}else l=I[41];I[45]!==l?(r=(0,s.jsxs)("div",{className:"w-1/3 border-r pr-4 flex flex-col",children:[t,(0,s.jsx)("div",{className:"flex-1 overflow-y-auto space-y-2",children:l})]}),I[45]=l,I[46]=r):r=I[46],_=(0,s.jsxs)("div",{className:"h-[calc(100vh-10rem)] flex",children:[r,u&&x&&(0,s.jsxs)("div",{className:"w-2/3 pl-4 flex flex-col",children:[(0,s.jsx)("div",{className:"border-b pb-2 mb-4",children:(0,s.jsx)("h2",{className:"text-xl font-semibold",children:x.name})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto space-y-4 p-4 bg-background rounded-md",children:u.messages.map(e=>(0,s.jsxs)("div",{className:(0,f.cn)("flex gap-3",e.senderId===U.id?"justify-end":"justify-start"),children:[e.senderId!==U.id&&(0,s.jsx)(o.default,{name:x.name,avatarUrl:x.avatarUrl}),(0,s.jsx)("div",{className:(0,f.cn)("p-3 rounded-lg max-w-xs lg:max-w-md",e.senderId===U.id?"bg-primary text-primary-foreground":"bg-muted"),children:(0,s.jsx)("p",{children:e.text})}),e.senderId===U.id&&(0,s.jsx)(o.default,{name:U.name,avatarUrl:U.avatarUrl})]},e.id))}),(0,s.jsxs)("form",{onSubmit:K,className:"mt-4 flex gap-2",children:[(0,s.jsx)(n.Input,{placeholder:"Type a message...",value:E,onChange:e=>O(e.target.value),disabled:P}),(0,s.jsxs)(i.Button,{type:"submit",disabled:P||!E.trim(),children:[P?(0,s.jsx)(c.Loader2,{className:"w-4 h-4 animate-spin"}):(0,s.jsx)(d,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Send"})]})]})]})]})}I[23]=C,I[24]=T,I[25]=U,I[26]=K,I[27]=P,I[28]=E,I[29]=_,I[30]=k}else _=I[29],k=I[30];return k!==Symbol.for("react.early_return_sentinel")?k:_}function b(e,s){return new Date(e.timestamp).getTime()-new Date(s.timestamp).getTime()}function v(e){return e.data()}function g(e){return e.participantIds}function y(e){return{id:e.id,...e.data()}}function S(){let e,t=(0,a.c)(1);return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,s.jsx)(j,{}),t[0]=e):e=t[0],e}e.s(["default",()=>S],80408)}]);