module.exports=[96221,a=>{"use strict";let b=(0,a.i(70106).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],96221)},77883,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(5050);let e=(0,d.createServerReference)("601396b450b9baa1be53916f7a359e4dc2a35deaf8",d.callServer,void 0,d.findSourceMapURL,"sendMessage");var f=a.i(66718),g=a.i(99570),h=a.i(96221);let i=(0,a.i(70106).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var j=a.i(27142),k=a.i(38246),l=a.i(68114);a.i(69387);var m=a.i(60574);a.i(79597);var n=a.i(71559),o=a.i(27960),p=a.i(77430);function q(){let{user:a,isUserLoading:d}=(0,n.useUser)(),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(!0),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(!1),{toast:A}=(0,p.useToast)(),B=(0,n.useFirestore)(),C=(0,n.useMemoFirebase)(()=>a?.id&&B?(0,m.query)((0,m.collection)(B,"conversations"),(0,m.where)("participantIds","array-contains",a.id)):null,[a,B]);(0,c.useEffect)(()=>{if(!C){d||v(!1);return}v(!0);let b=(0,m.onSnapshot)(C,async b=>{let c=b.docs.map(a=>({id:a.id,...a.data()})),d=[...new Set(c.flatMap(a=>a.participantIds).filter(b=>b!==a?.id))];if(d.length>0){let b=(0,m.query)((0,m.collection)(B,"users"),(0,m.where)("id","in",d)),e=(await (0,m.getDocs)(b)).docs.map(a=>a.data()),f=c.map(b=>{let c=e.find(c=>b.participantIds.includes(c.id)&&c.id!==a?.id),d=[a,c].filter(Boolean);return{...b,participants:d,messages:b.messages.sort((a,b)=>new Date(a.timestamp).getTime()-new Date(b.timestamp).getTime())}});r(f),f.length>0&&!s&&t(f[0].id)}else r([]);v(!1)},a=>{console.error("Error fetching conversations:",a),v(!1)});return()=>b()},[C,a,s,B,d]);let D=async b=>{if(b.preventDefault(),!w.trim()||!s||!a)return;z(!0);let c={id:`temp-${Date.now()}`,senderId:a.id,text:w,timestamp:new Date().toISOString()};r(q.map(a=>a.id===s?{...a,messages:[...a.messages,c]}:a)),x("");let d=await e(s,{senderId:a.id,text:w});d.success||(A({title:"Error Sending Message",description:d.error,variant:"destructive"}),r(q)),z(!1)};if(d||u)return(0,b.jsxs)("div",{className:"h-[calc(100vh-10rem)] flex",children:[(0,b.jsxs)("div",{className:"w-1/3 border-r pr-4 flex flex-col",children:[(0,b.jsx)(o.Skeleton,{className:"h-8 w-40 mb-4"}),(0,b.jsx)(o.Skeleton,{className:"h-16 w-full mb-2"}),(0,b.jsx)(o.Skeleton,{className:"h-16 w-full mb-2"}),(0,b.jsx)(o.Skeleton,{className:"h-16 w-full"})]}),(0,b.jsxs)("div",{className:"w-2/3 pl-4 flex flex-col",children:[(0,b.jsx)(o.Skeleton,{className:"h-6 w-48 mb-4 border-b pb-2"}),(0,b.jsxs)("div",{className:"flex-1 space-y-4 p-4",children:[(0,b.jsx)(o.Skeleton,{className:"h-12 w-3/4"}),(0,b.jsx)(o.Skeleton,{className:"h-12 w-3/4 ml-auto"}),(0,b.jsx)(o.Skeleton,{className:"h-12 w-3/4"})]}),(0,b.jsxs)("form",{className:"mt-4 flex gap-2",children:[(0,b.jsx)(o.Skeleton,{className:"h-10 flex-1"}),(0,b.jsx)(o.Skeleton,{className:"h-10 w-10"})]})]})]});if(!a)return(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:"Please log in to view your messages."});let E=q.find(a=>a.id===s);if(0===q.length)return(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:"No conversations yet. Start a new one!"});if(q.length>0&&!E)return(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:"Select a conversation to start chatting."});let F=E.participants.find(b=>b.id!==a.id);return(0,b.jsxs)("div",{className:"h-[calc(100vh-10rem)] flex",children:[(0,b.jsxs)("div",{className:"w-1/3 border-r pr-4 flex flex-col",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold font-headline mb-4",children:"Messages"}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto space-y-2",children:q.map(c=>{let d=c.participants.find(b=>b.id!==a.id);if(!d)return null;let e=c.messages[c.messages.length-1];return(0,b.jsx)(k.default,{href:"#",onClick:()=>t(c.id),children:(0,b.jsxs)("div",{className:(0,l.cn)("p-3 rounded-lg flex gap-3 items-start",c.id===s?"bg-accent":"hover:bg-accent/50"),children:[(0,b.jsx)(j.default,{name:d.name,avatarUrl:d.avatarUrl}),(0,b.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,b.jsx)("p",{className:"font-semibold truncate",children:d.name}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e?.text})]})]})},c.id)})})]}),E&&F&&(0,b.jsxs)("div",{className:"w-2/3 pl-4 flex flex-col",children:[(0,b.jsx)("div",{className:"border-b pb-2 mb-4",children:(0,b.jsx)("h2",{className:"text-xl font-semibold",children:F.name})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto space-y-4 p-4 bg-background rounded-md",children:E.messages.map(c=>(0,b.jsxs)("div",{className:(0,l.cn)("flex gap-3",c.senderId===a.id?"justify-end":"justify-start"),children:[c.senderId!==a.id&&(0,b.jsx)(j.default,{name:F.name,avatarUrl:F.avatarUrl}),(0,b.jsx)("div",{className:(0,l.cn)("p-3 rounded-lg max-w-xs lg:max-w-md",c.senderId===a.id?"bg-primary text-primary-foreground":"bg-muted"),children:(0,b.jsx)("p",{children:c.text})}),c.senderId===a.id&&(0,b.jsx)(j.default,{name:a.name,avatarUrl:a.avatarUrl})]},c.id))}),(0,b.jsxs)("form",{onSubmit:D,className:"mt-4 flex gap-2",children:[(0,b.jsx)(f.Input,{placeholder:"Type a message...",value:w,onChange:a=>x(a.target.value),disabled:y}),(0,b.jsxs)(g.Button,{type:"submit",disabled:y||!w.trim(),children:[y?(0,b.jsx)(h.Loader2,{className:"w-4 h-4 animate-spin"}):(0,b.jsx)(i,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Send"})]})]})]})]})}function r(){return(0,b.jsx)(q,{})}a.s(["default",()=>r],77883)}];

//# sourceMappingURL=_bbb191a2._.js.map