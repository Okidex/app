(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2164],{3998:(e,r,t)=>{"use strict";t.d(r,{$:()=>u,r:()=>o});var s=t(95155),a=t(12115),i=t(32467),n=t(83101),l=t(64269);let o=(0,n.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=a.forwardRef((e,r)=>{let{className:t,variant:a,size:n,asChild:u=!1,...d}=e,c=u?i.DX:"button";return(0,s.jsx)(c,{className:(0,l.cn)(o({variant:a,size:n,className:t})),ref:r,...d})});u.displayName="Button"},5761:(e,r,t)=>{"use strict";t.r(r),t.d(r,{FirebaseClientProvider:()=>g,FirebaseContext:()=>f,FirebaseProvider:()=>m,FirestorePermissionError:()=>y,errorEmitter:()=>d,getSdks:()=>E,initializeFirebase:()=>S,useAuth:()=>h,useCollection:()=>j,useDoc:()=>w,useFirebase:()=>p,useFirebaseApp:()=>x,useFirestore:()=>v,useMemoFirebase:()=>b,useUser:()=>N});let s={apiKey:"AIzaSyCUgXy6tmPnuyD0w6TmPwXDHGiUm_Id4yc",authDomain:"studio-8509111427-a45a7.firebaseapp.com",projectId:"studio-8509111427-a45a7",storageBucket:"studio-8509111427-a45a7.appspot.com",messagingSenderId:"866288675038",appId:"1:866288675038:web:faff2fb1b41f0e10f47a4f"};var a=t(52078),i=t(59253),n=t(19708),l=t(58134),o=t(95155),u=t(12115);let d=function(){let e={};return{on(r,t){var s;e[r]||(e[r]=[]),null==(s=e[r])||s.push(t)},off(r,t){var s;e[r]&&(e[r]=null==(s=e[r])?void 0:s.filter(e=>e!==t))},emit(r,t){var s;e[r]&&(null==(s=e[r])||s.forEach(e=>e(t)))}}}();function c(){let[e,r]=(0,u.useState)(null);if((0,u.useEffect)(()=>{let e=e=>{r(e)};return d.on("permission-error",e),()=>{d.off("permission-error",e)}},[]),e)throw e;return null}let f=(0,u.createContext)(void 0),m=e=>{let{children:r,firebaseApp:t,firestore:s,auth:a}=e,[n,l]=(0,u.useState)({user:null,isUserLoading:!0,userError:null});(0,u.useEffect)(()=>{if(!a)return void l({user:null,isUserLoading:!1,userError:Error("Auth service not provided.")});let e=(0,i.hg)(a,e=>{l({user:e,isUserLoading:!1,userError:null})},e=>{console.error("FirebaseProvider: onAuthStateChanged error:",e),l({user:null,isUserLoading:!1,userError:e})});return()=>e()},[a]);let d=(0,u.useMemo)(()=>{let e=!!(t&&s&&a);return{areServicesAvailable:e,firebaseApp:e?t:null,firestore:e?s:null,auth:e?a:null,user:n.user,isUserLoading:n.isUserLoading,userError:n.userError}},[t,s,a,n]);return(0,o.jsxs)(f.Provider,{value:d,children:[(0,o.jsx)(c,{}),r]})},p=()=>{let e=(0,u.useContext)(f);if(void 0===e)throw Error("useFirebase must be used within a FirebaseProvider.");if(!e.areServicesAvailable||!e.firebaseApp||!e.firestore||!e.auth)throw Error("Firebase core services not available. Check FirebaseProvider props.");return{firebaseApp:e.firebaseApp,firestore:e.firestore,auth:e.auth,user:e.user,isUserLoading:e.isUserLoading,userError:e.userError}},h=()=>{let{auth:e}=p();return e},v=()=>{let{firestore:e}=p();return e},x=()=>{let{firebaseApp:e}=p();return e};function b(e,r){let t=(0,u.useMemo)(e,r);return"object"!=typeof t||null===t||(t.__memo=!0),t}function g(e){let{children:r}=e,t=(0,u.useMemo)(()=>S(),[]);return(0,o.jsx)(m,{firebaseApp:t.firebaseApp,auth:t.auth,firestore:t.firestore,children:r})}class y extends Error{constructor(e){let r=function(e){let r=null;try{let e=(0,i.xI)().currentUser;e&&(r=function(e){var r;if(!e)return null;let t={name:e.displayName,email:e.email,email_verified:e.emailVerified,phone_number:e.phoneNumber,sub:e.uid,firebase:{identities:e.providerData.reduce((e,r)=>(r.providerId&&(e[r.providerId]=[r.uid]),e),{}),sign_in_provider:(null==(r=e.providerData[0])?void 0:r.providerId)||"custom",tenant:e.tenantId}};return{uid:e.uid,token:t}}(e))}catch(e){}return{auth:r,method:e.operation,path:"/databases/(default)/documents/".concat(e.path),resource:e.requestResourceData?{data:e.requestResourceData}:void 0}}(e);super("Missing or insufficient permissions: The following request was denied by Firestore Security Rules:\n".concat(JSON.stringify(r,null,2))),this.name="FirebaseError",this.request=r}}function j(e){let[r,t]=(0,u.useState)(null),[s,a]=(0,u.useState)(!0),[i,l]=(0,u.useState)(null);if((0,u.useEffect)(()=>{if(!e){t(null),a(!1),l(null);return}a(!0),l(null);let r=(0,n.aQ)(e,e=>{let r=[];for(let t of e.docs)r.push({...t.data(),id:t.id});t(r),l(null),a(!1)},r=>{let s=new y({operation:"list",path:"collection"===e.type?e.path:e._query.path.canonicalString()});l(s),t(null),a(!1),d.emit("permission-error",s)});return()=>r()},[e]),e&&!e.__memo)throw Error("useCollection query was not properly memoized using useMemoFirebase");return{data:r,isLoading:s,error:i}}function w(e){let[r,t]=(0,u.useState)(null),[s,a]=(0,u.useState)(!0),[i,l]=(0,u.useState)(null);if((0,u.useEffect)(()=>{if(!e){t(null),a(!1),l(null);return}a(!0),l(null);let r=(0,n.aQ)(e,e=>{e.exists()?t({...e.data(),id:e.id}):t(null),l(null),a(!1)},r=>{let s=new y({operation:"get",path:e.path});l(s),t(null),a(!1),d.emit("permission-error",s)});return()=>r()},[e]),e&&!e.__memo)throw Error("useDoc query was not properly memoized using useMemoFirebase");return{data:r,isLoading:s,error:i}}let N=()=>{let{user:e,isUserLoading:r,userError:t}=p();return{user:e,isUserLoading:r,userError:t}};function S(){return(0,a.Dk)().length>0?E((0,a.Sx)()):E((0,a.Wp)(s))}function E(e){return{firebaseApp:e,auth:(0,i.xI)(e),firestore:(0,n.aU)(e),storage:(0,l.c7)(e)}}},15894:(e,r,t)=>{"use strict";t.d(r,{dj:()=>c});var s=t(12115);let a=0,i=new Map,n=e=>{if(i.has(e))return;let r=setTimeout(()=>{i.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,r)},l=[],o={toasts:[]};function u(e){o=((e,r)=>{switch(r.type){case"ADD_TOAST":return{...e,toasts:[r.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===r.toast.id?{...e,...r.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=r;return t?n(t):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===r.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==r.toastId)}}})(o,e),l.forEach(e=>{e(o)})}function d(e){let{...r}=e,t=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>u({type:"DISMISS_TOAST",toastId:t});return u({type:"ADD_TOAST",toast:{...r,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function c(){let[e,r]=s.useState(o);return s.useEffect(()=>(l.push(r),()=>{let e=l.indexOf(r);e>-1&&l.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}},20243:(e,r,t)=>{"use strict";t.d(r,{E:()=>i});var s=t(95155),a=t(64269);function i(e){let{className:r,...t}=e;return(0,s.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",r),...t})}},27255:(e,r,t)=>{"use strict";t.d(r,{H:()=>a});var s=t(30926);let a=(0,s.createServerReference)("00ebc297e0a702443624bfbf7cb91eaa1ed8b39480",s.callServer,void 0,s.findSourceMapURL,"getCurrentUser")},36402:(e,r,t)=>{"use strict";t.d(r,{A:()=>d});var s=t(95155),a=t(12115),i=t(46591),n=t(64269);let l=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(i.bL,{ref:r,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...a})});l.displayName=i.bL.displayName;let o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(i._V,{ref:r,className:(0,n.cn)("aspect-square h-full w-full",t),...a})});o.displayName=i._V.displayName;let u=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(i.H4,{ref:r,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...a})});u.displayName=i.H4.displayName;let d=e=>{let{name:r,avatarUrl:t,className:a}=e;return(0,s.jsxs)(l,{className:(0,n.cn)("h-10 w-10",a),children:[(0,s.jsx)(o,{src:t,alt:r}),(0,s.jsx)(u,{children:(e=>{if(!e)return"";let r=e.split(" ");return r.length>1?"".concat(r[0][0]).concat(r[r.length-1][0]).toUpperCase():e.substring(0,2).toUpperCase()})(r)})]})}},54958:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>y});var s=t(95155),a=t(12115),i=t(27255),n=t(30926);let l=(0,n.createServerReference)("60a7e86ba3defb903a6fea980f04582ed06bae5108",n.callServer,void 0,n.findSourceMapURL,"sendMessage");var o=t(65142),u=t(3998),d=t(92033),c=t(94979),f=t(36402),m=t(52619),p=t.n(m),h=t(64269),v=t(19708),x=t(5761),b=t(20243),g=t(15894);function y(){let{user:e,isUserLoading:r}=(0,x.useUser)(),[t,n]=(0,a.useState)(null),[m,y]=(0,a.useState)([]),[j,w]=(0,a.useState)(null),[N,S]=(0,a.useState)(!0),[E,A]=(0,a.useState)(""),[I,_]=(0,a.useState)(!1),{toast:U}=(0,g.dj)(),T=(0,x.useFirestore)();(0,a.useEffect)(()=>{!r&&e?(0,i.H)().then(n):r||e||S(!1)},[e,r]),(0,a.useEffect)(()=>{if(!t||!T)return;S(!0);let e=(0,v.P)((0,v.rJ)(T,"conversations"),(0,v._M)("participantIds","array-contains",t.id)),r=(0,v.aQ)(e,async e=>{let r=e.docs.map(e=>({id:e.id,...e.data()})),s=[...new Set(r.flatMap(e=>e.participantIds).filter(e=>e!==t.id))];if(s.length>0){let e=(0,v.P)((0,v.rJ)(T,"users"),(0,v._M)("id","in",s)),a=(await (0,v.GG)(e)).docs.map(e=>e.data()),i=r.map(e=>{let r=a.find(r=>e.participantIds.includes(r.id)&&r.id!==t.id),s=[t,r].filter(Boolean);return{...e,participants:s,messages:e.messages.sort((e,r)=>new Date(e.timestamp).getTime()-new Date(r.timestamp).getTime())}});y(i),i.length>0&&!j&&w(i[0].id)}else y([]);S(!1)},e=>{console.error("Error fetching conversations:",e),S(!1)});return()=>r()},[t,j,T]);let D=async e=>{if(e.preventDefault(),!E.trim()||!j||!t)return;_(!0);let r={id:"temp-".concat(Date.now()),senderId:t.id,text:E,timestamp:new Date().toISOString()};y(m.map(e=>e.id===j?{...e,messages:[...e.messages,r]}:e)),A("");let s=await l(j,{senderId:t.id,text:E});s.success||(U({title:"Error Sending Message",description:s.error,variant:"destructive"}),y(m)),_(!1)};if(r||N)return(0,s.jsxs)("div",{className:"h-[calc(100vh-10rem)] flex",children:[(0,s.jsxs)("div",{className:"w-1/3 border-r pr-4 flex flex-col",children:[(0,s.jsx)(b.E,{className:"h-8 w-40 mb-4"}),(0,s.jsx)(b.E,{className:"h-16 w-full mb-2"}),(0,s.jsx)(b.E,{className:"h-16 w-full mb-2"}),(0,s.jsx)(b.E,{className:"h-16 w-full"})]}),(0,s.jsxs)("div",{className:"w-2/3 pl-4 flex flex-col",children:[(0,s.jsx)(b.E,{className:"h-6 w-48 mb-4 border-b pb-2"}),(0,s.jsxs)("div",{className:"flex-1 space-y-4 p-4",children:[(0,s.jsx)(b.E,{className:"h-12 w-3/4"}),(0,s.jsx)(b.E,{className:"h-12 w-3/4 ml-auto"}),(0,s.jsx)(b.E,{className:"h-12 w-3/4"})]}),(0,s.jsxs)("form",{className:"mt-4 flex gap-2",children:[(0,s.jsx)(b.E,{className:"h-10 flex-1"}),(0,s.jsx)(b.E,{className:"h-10 w-10"})]})]})]});if(!t)return(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:"Please log in to view your messages."});let M=m.find(e=>e.id===j);if(0===m.length)return(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:"No conversations yet. Start a new one!"});if(m.length>0&&!M)return(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:"Select a conversation to start chatting."});let F=M.participants.find(e=>e.id!==t.id);return(0,s.jsxs)("div",{className:"h-[calc(100vh-10rem)] flex",children:[(0,s.jsxs)("div",{className:"w-1/3 border-r pr-4 flex flex-col",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold font-headline mb-4",children:"Messages"}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto space-y-2",children:m.map(e=>{let r=e.participants.find(e=>e.id!==t.id);if(!r)return null;let a=e.messages[e.messages.length-1];return(0,s.jsx)(p(),{href:"#",onClick:()=>w(e.id),children:(0,s.jsxs)("div",{className:(0,h.cn)("p-3 rounded-lg flex gap-3 items-start",e.id===j?"bg-accent":"hover:bg-accent/50"),children:[(0,s.jsx)(f.A,{name:r.name,avatarUrl:r.avatarUrl}),(0,s.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,s.jsx)("p",{className:"font-semibold truncate",children:r.name}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:null==a?void 0:a.text})]})]})},e.id)})})]}),M&&F&&(0,s.jsxs)("div",{className:"w-2/3 pl-4 flex flex-col",children:[(0,s.jsx)("div",{className:"border-b pb-2 mb-4",children:(0,s.jsx)("h2",{className:"text-xl font-semibold",children:F.name})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto space-y-4 p-4 bg-background rounded-md",children:M.messages.map(e=>(0,s.jsxs)("div",{className:(0,h.cn)("flex gap-3",e.senderId===t.id?"justify-end":"justify-start"),children:[e.senderId!==t.id&&(0,s.jsx)(f.A,{name:F.name,avatarUrl:F.avatarUrl}),(0,s.jsx)("div",{className:(0,h.cn)("p-3 rounded-lg max-w-xs lg:max-w-md",e.senderId===t.id?"bg-primary text-primary-foreground":"bg-muted"),children:(0,s.jsx)("p",{children:e.text})}),e.senderId===t.id&&(0,s.jsx)(f.A,{name:t.name,avatarUrl:t.avatarUrl})]},e.id))}),(0,s.jsxs)("form",{onSubmit:D,className:"mt-4 flex gap-2",children:[(0,s.jsx)(o.p,{placeholder:"Type a message...",value:E,onChange:e=>A(e.target.value),disabled:I}),(0,s.jsxs)(u.$,{type:"submit",disabled:I||!E.trim(),children:[I?(0,s.jsx)(d.A,{className:"w-4 h-4 animate-spin"}):(0,s.jsx)(c.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Send"})]})]})]})]})}},56666:(e,r,t)=>{Promise.resolve().then(t.bind(t,54958))},64269:(e,r,t)=>{"use strict";t.d(r,{cn:()=>i});var s=t(2821),a=t(75889);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.QP)((0,s.$)(r))}},65142:(e,r,t)=>{"use strict";t.d(r,{p:()=>n});var s=t(95155),a=t(12115),i=t(64269);let n=a.forwardRef((e,r)=>{let{className:t,type:a,...n}=e;return(0,s.jsx)("input",{type:a,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...n})});n.displayName="Input"}},e=>{e.O(0,[2992,7138,4909,3947,2619,3782,8441,1255,7358],()=>e(e.s=56666)),_N_E=e.O()}]);